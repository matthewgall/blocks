{{template "layout.html" .}}

{{define "content"}}
<div class="card">
    <div class="page-header">
        <h1>{{if .Item.ID}}Edit Collection Item{{else}}Add Collection Item{{end}}</h1>
        <a href="/collection" class="btn btn-secondary">Cancel</a>
    </div>

    <p class="text-muted mt-0-25">Build your collection one brick at a time.</p>

    {{template "flash" .}}

    {{if eq .role "viewer"}}
    <p>You do not have permission to edit collection items.</p>
    {{else}}
    <form id="collection-item-form" method="post" enctype="multipart/form-data" {{if .Item.ID}}action="/collection/{{.Item.ID}}/update"{{else}}action="/collection"{{end}}>
        {{template "csrf_input" .}}
        <div class="grid">
            <div class="form-group">
                <label for="set_id">Set *</label>
                <select id="set_id" name="set_id" required>
                    <option value="">Select Set</option>
                    {{range .Sets}}
                    <option value="{{.ID}}" {{if eq $.Item.SetID .ID}}selected{{end}}>{{.Name}} ({{.SetCode}})</option>
                    {{end}}
                </select>
            </div>
            
            <div class="form-group">
                <label for="quantity">Quantity *</label>
                <input type="number" id="quantity" name="quantity" value="{{.Item.Quantity}}" min="1" required>
            </div>
            
            <div class="form-group">
                <label for="condition">Condition *</label>
                <select id="condition" name="condition" required>
                    <option value="">Select Condition</option>
                    <option value="sealed" {{if eq .Item.Condition "sealed"}}selected{{end}}>Sealed</option>
                    <option value="open" {{if eq .Item.Condition "open"}}selected{{end}}>Open</option>
                    <option value="partial" {{if eq .Item.Condition "partial"}}selected{{end}}>Partial</option>
                    <option value="custom" {{if eq .Item.Condition "custom"}}selected{{end}}>Custom</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="status">Status *</label>
                <select id="status" name="status" required>
                    <option value="">Select Status</option>
                    <option value="active" {{if eq .Item.Status "active"}}selected{{end}}>Active</option>
                    <option value="sold" {{if eq .Item.Status "sold"}}selected{{end}}>Sold</option>
                    <option value="donated" {{if eq .Item.Status "donated"}}selected{{end}}>Donated</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="location">Location</label>
                <input type="text" id="location" name="location" value="{{value .Item.Location}}" placeholder="e.g., Loft / Box A / Shelf 3">
            </div>
            
            <div class="form-group">
                <label for="purchase_price">Purchase Price</label>
                <input type="number" id="purchase_price" name="purchase_price" value="{{value .Item.PurchasePrice}}" step="0.01" min="0">
            </div>
            
            <div class="form-group">
                <label for="purchase_date">Purchase Date</label>
                <input type="date" id="purchase_date" name="purchase_date" value="{{value .Item.PurchaseDate}}">
            </div>
        </div>

        <div class="form-group grid-span-full">
            <label for="missing_notes">Missing Pieces/Notes</label>
            <textarea id="missing_notes" name="missing_notes" rows="4" placeholder="Note any missing pieces or damage...">{{value .Item.MissingNotes}}</textarea>
        </div>

        {{template "collection_images" (dict "Item" .Item "FormID" "collection-item-form")}}

        <div class="form-group grid-span-full">
            <label for="tags">Tags</label>
            {{template "tag_input" .}}
            <p class="text-muted mt-0-25">Separate tags with commas.</p>
        </div>

        <div class="actions mt-2">
            <button type="submit" class="btn btn-success">{{if .Item.ID}}Update Item{{else}}Add Item{{end}}</button>
            <a href="/collection" class="btn btn-secondary">Cancel</a>
        </div>
    </form>
    {{end}}
</div>

{{end}}
